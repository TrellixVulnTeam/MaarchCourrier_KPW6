<form>
    <input type="hidden" [formControl]="controlAutocomplete">
    <mat-form-field floatLabel="never" class="input-form" *ngIf="!controlAutocomplete.disabled">
        <mat-icon color="primary" class="fa fa-search" matPrefix style="padding-left: 20px;font-size: 15px;"></mat-icon>
        <input type="text" #autoCompleteInput [placeholder]="lang.searchContact" matInput [formControl]="myControl"
            [matAutocomplete]="auto" (click)="$event.stopPropagation()" (focus)="resetAutocomplete()" maxlength="128">
        <button [disabled]="!canAdd" type="button" matSuffix mat-icon-button (click)="addItem()">
            <mat-icon class="fa fa-plus" [title]="lang.add"
                [style.visibility]="canAdd && myControl.value !== null && myControl.value.length > 0 ? 'visible' : 'hidden'">
            </mat-icon>
        </button>
        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectOpt($event)">
            <ng-container *ngIf="options.length > 0 && !loading">
                <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
                    <mat-card>
                        <mat-card-header class="contact-header">
                            <div mat-card-avatar class="contact-header-image fa"
                                [class.fa-address-card]="option.type === 'contact'" [class.fa-users]="option.type ==='contactGroup'"
                                [class.fa-sitemap]="option.type ==='entity'" [class.fa-user]="option.type ==='user'"
                                [title]="lang['contact_'+option.type]">
                            </div>
                            <mat-card-title *ngIf="!empty(option.firstname) || !empty(option.lastname)" [title]="option.firstname + ' ' + option.lastname">{{option.firstname}}
                                {{option.lastname}}</mat-card-title>
                            <mat-card-title *ngIf="empty(option.firstname) && empty(option.lastname)" [title]="option.company">{{option.company}}</mat-card-title>
                            <mat-card-subtitle [title]="option.function" *ngIf="!empty(option.function)">
                                {{option.function}}&nbsp;
                            </mat-card-subtitle>
                            <i class="contact-filling fa fa-circle"
                                *ngIf="option.type === 'contact' && option.fillingRate !== undefined"
                                [style.color]="option.fillingRate.color"
                                [title]="lang.contactsFillingRate + ' : ' + option.fillingRate.rate + '%'"></i>
                        </mat-card-header>
                        <mat-card-content>
                            <mat-list>
                                <mat-list-item class="contact-item" *ngIf="(!empty(option.firstname) || !empty(option.lastname)) && !empty(option.company)">
                                    <mat-icon mat-list-icon class="contact-group far fa-building"
                                        [title]="lang.contactsParameters_company"></mat-icon>
                                    <p mat-line class="contact-content" [title]="option.company"> {{option.company}}
                                    </p>
                                </mat-list-item>
                                <mat-list-item class="contact-item" *ngIf="!empty(option.department)">
                                    <mat-icon mat-list-icon class="contact-group fa fa-sitemap"
                                        [title]="lang.contactsParameters_department"></mat-icon>
                                    <p mat-line class="contact-content" [title]="option.department">
                                        {{option.department}} </p>
                                    <p mat-line class="contact-content" *ngIf="!empty(option.occupancy)"
                                        [title]="option.occupancy"> ({{option.occupancy}}) </p>
                                </mat-list-item>
                                <mat-list-item class="contact-item" *ngIf="!empty(option.email)">
                                    <mat-icon mat-list-icon class="contact-group far fa-envelope" [title]="lang.email">
                                    </mat-icon>
                                    <p mat-line class="contact-content" [title]="option.email"> {{option.email}} </p>
                                </mat-list-item>
                                <mat-list-item class="contact-item" *ngIf="!empty(option.phone)">
                                    <mat-icon mat-list-icon class="contact-group fas fa-phone"
                                        [title]="lang.phoneNumber">
                                    </mat-icon>
                                    <p mat-line class="contact-content" [title]="option.phone"> {{option.phone}} </p>
                                </mat-list-item>
                                <mat-list-item class="contact-address" [title]="lang.address"
                                    *ngIf="!empty(option.number) || !empty(option.street) || !empty(option.complement) || !empty(option.postalCode) || !empty(option.town) || !empty(option.country)">
                                    <mat-icon mat-list-icon class="contact-group fas fa-map-marker-alt"></mat-icon>
                                    <p mat-line class="contact-content"
                                        *ngIf="!empty(option.number) || !empty(option.street)" [title]="option.street">
                                        {{option.number}} {{option.street}} </p>
                                    <p mat-line class="contact-content" *ngIf="!empty(option.complement)"
                                        [title]="option.complement"> ({{option.complement}}) </p>
                                    <p mat-line class="contact-content"
                                        *ngIf="!empty(option.postalCode) || !empty(option.town)"
                                        [title]="option.postalCode + ' ' + option.town"> {{option.postalCode}}
                                        {{option.town}} </p>
                                    <p mat-line class="contact-content" *ngIf="!empty(option.country)"
                                        [title]="option.country"> {{option.country}} </p>
                                </mat-list-item>
                            </mat-list>
                        </mat-card-content>
                    </mat-card>
                </mat-option>
            </ng-container>
            <mat-option class="autoCompleteInfoResult smallInputInfo" *ngIf="options.length === 0 && !loading" disabled
                [innerHTML]="listInfo">
            </mat-option>
            <mat-option *ngIf="loading" disabled>
                <mat-spinner diameter="20"></mat-spinner>
            </mat-option>
        </mat-autocomplete>
    </mat-form-field>
    <div class="itemList">
        <mat-chip-list *ngIf="controlAutocomplete.value.length > 0" class="mat-chip-list-stacked itemChip"
            color="default">
            <ng-container *ngIf="!loadingValues">
                <mat-chip *ngFor="let item of controlAutocomplete.value;let i=index" class="listAutocomplete"
                    color="default" [removable]="!controlAutocomplete.disabled" (removed)="removeItem(i)">
                    <span style="display: flex;flex: 1;align-items: center;">
                        <i class="fa" [class.fa-address-card]="this.valuesToDisplay[item.id].type === 'contact'"
                            [class.fa-sitemap]="this.valuesToDisplay[item.id].type ==='entity'"
                            [class.fa-user]="this.valuesToDisplay[item.id].type ==='user'"
                            [title]="lang[this.valuesToDisplay[item.id].type]"
                            style="padding-right:5px;"></i>
                            <ng-container *ngIf="!empty(this.valuesToDisplay[item.id].firstname)">
                                {{this.valuesToDisplay[item.id].firstname}}
                            </ng-container>

                        {{this.valuesToDisplay[item.id].lastname}} <ng-container
                            *ngIf="!empty(this.valuesToDisplay[item.id].company)">
                            ({{this.valuesToDisplay[item.id].company}})</ng-container>
                    </span>
                    <mat-icon matChipRemove class="fa fa-times" *ngIf="!controlAutocomplete.disabled"></mat-icon>
                </mat-chip>
            </ng-container>
        </mat-chip-list>
        <div class="noResult" *ngIf="controlAutocomplete.value.length === 0">
            {{lang.noSelectedContact}}
        </div>
    </div>
</form>