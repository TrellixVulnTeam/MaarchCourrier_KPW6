<h1 mat-dialog-title>
    <span style="flex: 1;">
        Envoyer un élement
    </span>
    <button [title]="lang.close" mat-icon-button (click)="dialogRef.close();">
        <mat-icon class="fa fa-times"></mat-icon>
    </button></h1>
<mat-dialog-content class="modal-container">
    <mat-form-field>
        <span matPrefix>De&nbsp;:&nbsp;</span>
        <mat-select [(ngModel)]="currentSender">
            <mat-option *ngFor="let email of availableSenders | sortBy: 'label'" [value]="email">
                {{email.label}} ({{email.email}})
            </mat-option>
        </mat-select>
        <button mat-button matSuffix [class.activeButton]="showCopies" (click)="$event.stopPropagation();showCopies = !showCopies">Cc</button>
        <button mat-button matSuffix [class.activeButton]="showInvisibleCopies"
            (click)="$event.stopPropagation();showInvisibleCopies = !showInvisibleCopies">Cci</button>
    </mat-form-field>

    <mat-form-field>
        <span matPrefix>À&nbsp;:&nbsp;</span>
        <mat-chip-list id="recipients-list" #recipientsList cdkDropList [cdkDropListConnectedTo]="['copies-list','invcopies-list']" [cdkDropListData]="recipients" (cdkDropListDropped)="drop($event)">
            <mat-chip cdkDrag class="recipients" *ngFor="let recipient of recipients" [selectable]="selectable" removable
                (removed)="remove(recipient, 'recipients')">
                {{recipient.email}}
                <mat-icon matChipRemove class="fa fa-times"></mat-icon>
            </mat-chip>
            <input [formControl]="recipientsInput" [matChipInputFor]="recipientsList"
                [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="true"
                (matChipInputTokenEnd)="add($event, 'recipients')" [matAutocomplete]="autoEmails" (focus)="resetAutocomplete()">
        </mat-chip-list>
        <mat-autocomplete #autoEmails="matAutocomplete" (optionSelected)="addEmail($event.option.value, 'recipients')">
            <mat-option *ngFor="let option of filteredEmails | async" [value]="option">
                {{option.label}}
            </mat-option>
        </mat-autocomplete>
    </mat-form-field>

    <mat-form-field *ngIf="showCopies">
        <span matPrefix>Cc&nbsp;:&nbsp;</span>
        <mat-chip-list id="copies-list" #copiesList cdkDropList [cdkDropListConnectedTo]="['recipients-list','invcopies-list']" [cdkDropListData]="copies" (cdkDropListDropped)="drop($event)">
            <mat-chip cdkDrag class="copy" *ngFor="let copy of copies" [selectable]="selectable" removable
                (removed)="remove(copy, 'copies')">
                {{copy.email}}
                <mat-icon matChipRemove class="fa fa-times"></mat-icon>
            </mat-chip>
            <input [formControl]="recipientsInput" [matChipInputFor]="copiesList"
                [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="true"
                (matChipInputTokenEnd)="add($event, 'copies')" [matAutocomplete]="autoEmails2" (focus)="resetAutocomplete()">
        </mat-chip-list>
        <mat-autocomplete #autoEmails2="matAutocomplete" (optionSelected)="addEmail($event.option.value, 'copies')">
            <mat-option *ngFor="let option of filteredEmails | async" [value]="option">
                {{option.label}}
            </mat-option>
        </mat-autocomplete>
    </mat-form-field>

    <mat-form-field *ngIf="showInvisibleCopies">
        <span matPrefix>Cci&nbsp;:&nbsp;</span>
        <mat-chip-list id="invcopies-list" #invCopiesList cdkDropList [cdkDropListConnectedTo]="['recipients-list','copies-list']" [cdkDropListData]="copies" (cdkDropListDropped)="drop($event)">
            <mat-chip class="copy" *ngFor="let invCopy of invisibleCopies" [selectable]="selectable" removable
                (removed)="remove(invCopy, 'invisibleCopies')">
                {{invCopy.email}}
                <mat-icon matChipRemove class="fa fa-times"></mat-icon>
            </mat-chip>
            <input [formControl]="recipientsInput" [matChipInputFor]="invCopiesList"
                [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="true"
                (matChipInputTokenEnd)="add($event, 'invisibleCopies')" [matAutocomplete]="autoEmails3" (focus)="resetAutocomplete()">
        </mat-chip-list>
        <mat-autocomplete #autoEmails3="matAutocomplete" (optionSelected)="addEmail($event.option.value, 'invisibleCopies')">
            <mat-option *ngFor="let option of filteredEmails | async" [value]="option">
                {{option.label}}
            </mat-option>
        </mat-autocomplete>
    </mat-form-field>
    <mat-form-field floatLabel="never">
        <input matInput placeholder="Sujet" [(ngModel)]="emailsubject">
    </mat-form-field>
    <div class="models">
        <mat-form-field appearance="outline" style="font-size: 11px;">
            <mat-label>Modèle(s) de mail</mat-label>
            <mat-select [(ngModel)]="currentSelected" (selectionChange)="mergeEmailTemplate($event.value.id)">
                <mat-option *ngFor="let model of availableEmailModels" [value]="model">
                    {{model.label}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" style="font-size: 11px;">
            <mat-label>Signature(s) de mail</mat-label>
            <mat-select [(ngModel)]="currentSelected" (selectionChange)="mergeSignEmailTemplate($event.value.id)">
                <mat-option *ngFor="let model of availableSignEmailModels" [value]="model">
                    {{model.label}}
                </mat-option>
            </mat-select>
        </mat-form-field>
    </div>
    <editor #tinymce [(ngModel)]="tinymceInput"  [init]="tinyMCEConfig"></editor>
</mat-dialog-content>
<div mat-dialog-actions class="actions">
    <button mat-raised-button color="primary" (click)="onSubmit()">{{lang.validate}}</button>
</div>
