<mat-list *ngIf="!loading">
    <mat-form-field *ngIf="injectDatas.editable" appearance="outline" floatLabel="never" [style.fontSize.px]="10">
        <input id="availableUsers" type="text" matInput placeholder="{{lang.addPerson}}"
            [matAutocomplete]="auto" [formControl]="userCtrl">
        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="addItem($event)" isOpen="true">
            <mat-option *ngFor="let user of filteredUsers | async" [value]="user">
                {{user.idToDisplay}}
            </mat-option>
        </mat-autocomplete>
    </mat-form-field>
    <div cdkDropList #dataAvailableList="cdkDropList" [cdkDropListData]="visaWorkflow.items" class="cdk-list"
        (cdkDropListDropped)="drop($event)" [cdkDropListDisabled]="!injectDatas.editable">
        <div class="emptyContent" *ngIf="visaWorkflow.items.length === 0">
            {{lang.noPerson}}
        </div>
        <mat-list-item *ngFor="let diffusion of visaWorkflow.items;let i=index" cdkDrag class="columns"
            [cdkDragDisabled]="!injectDatas.editable" [class.notDraggable]="!injectDatas.editable"
            [class.notEditable]="!injectDatas.editable" [class.processed]="diffusion.process_date != null">
            <mat-icon mat-list-icon class="fa fa-user fa-2x" color="primary"></mat-icon>
            <ng-container *ngIf="!injectDatas.editable">
                <mat-icon mat-list-icon class="fa fa-hourglass fa-2x"
                    [ngClass]="{'fa-hourglass': diffusion.process_date == null,'fa-check': diffusion.process_date != null}"
                    style="opacity:0.5;"></mat-icon>
            </ng-container>
            <div mat-line style="display: flex;align-items: center;">
                <div style="flex:1;overflow: hidden;text-overflow: ellipsis;">
                    <div style="text-overflow: ellipsis;overflow: hidden;">
                        {{diffusion.labelToDisplay}}
                    </div>
                    <div style="opacity:0.5;flex: 1;text-overflow: ellipsis;overflow: hidden;">{{diffusion.item_entity}}</div>
                    <div *ngIf="diffusion.process_date != null"
                        title='{{diffusion.process_date | date : lang.onRange + " dd/MM/y " + lang.atRange +" HH:mm"}}'
                        style="flex: 1;text-align: right;font-size: 90%;" color="accent">{{diffusion.process_date
                                                | timeAgo}}</div>
                </div>
                <div>
                    <button class="currentRoleButton" [disabled]="!injectDatas.editable"  mat-button [matMenuTriggerFor]="menu"
                        title="{{lang[diffusion.currentRole+'User']}}">{{diffusion.requested_signature ? lang.signUser : lang.visaUser}}</button>
                    <mat-menu [class]="'listMenu'" #menu="matMenu">
                        <div
                            style="text-align: center;font-size: 10px;color: white;background: #135F7F;padding: 5px;font-weight: bold;">
                            {{lang.roles}}
                        </div>
                        <button *ngFor="let role of visaWorkflow.roles" mat-menu-item
                            (click)="changeRole(i)">{{lang[role+'User']}}</button>
                    </mat-menu>
                </div>

            </div>
            <button mat-icon-button *ngIf="injectDatas.editable" (click)="deleteItem(i)">
                <mat-icon class="fa fa-times" color="warn"></mat-icon>
            </button>
        </mat-list-item>
    </div>
</mat-list>